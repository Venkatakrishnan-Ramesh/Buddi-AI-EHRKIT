<!DOCTYPE article
PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD with MathML3 v1.3 20210610//EN" "JATS-archivearticle1-3-mathml3.dtd">
<article xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mml="http://www.w3.org/1998/Math/MathML" article-type="research-article" dtd-version="1.3"><?properties open_access?><processing-meta base-tagset="archiving" mathml-version="3.0" table-model="xhtml" tagset-family="jats"><restricted-by>pmc</restricted-by></processing-meta><front><journal-meta><journal-id journal-id-type="nlm-ta">MethodsX</journal-id><journal-id journal-id-type="iso-abbrev">MethodsX</journal-id><journal-title-group><journal-title>MethodsX</journal-title></journal-title-group><issn pub-type="epub">2215-0161</issn><publisher><publisher-name>Elsevier</publisher-name></publisher></journal-meta><article-meta><article-id pub-id-type="pmc">PMC9440422</article-id><article-id pub-id-type="pii">S2215-0161(22)00191-1</article-id><article-id pub-id-type="doi">10.1016/j.mex.2022.101811</article-id><article-id pub-id-type="publisher-id">101811</article-id><article-categories><subj-group subj-group-type="heading"><subject>Method Article</subject></subj-group></article-categories><title-group><article-title>Optimization of real-time analysis of sleep-wake cycle in mice</article-title></title-group><contrib-group><contrib contrib-type="author" id="au0001"><name><surname>Thankachan</surname><given-names>Stephen</given-names></name><xref rid="aff0001" ref-type="aff">a</xref></contrib><contrib contrib-type="author" id="au0002"><name><surname>Gerashchenko</surname><given-names>Andrei</given-names></name><xref rid="aff0002" ref-type="aff">b</xref></contrib><contrib contrib-type="author" id="au0003"><name><surname>Kastanenka</surname><given-names>Ksenia V</given-names></name><xref rid="aff0003" ref-type="aff">c</xref></contrib><contrib contrib-type="author" id="au0004"><name><surname>Bacskai</surname><given-names>Brian J</given-names></name><xref rid="aff0003" ref-type="aff">c</xref></contrib><contrib contrib-type="author" id="au0005"><name><surname>Gerashchenko</surname><given-names>Dmitry</given-names></name><email>dmitry_gerashchenko@hms.harvard.edu</email><xref rid="aff0001" ref-type="aff">a</xref><xref rid="cor0001" ref-type="corresp">&#x0204e;</xref></contrib><aff id="aff0001"><label>a</label>Harvard Medical School / Veterans Affairs Boston Healthcare System, West Roxbury, MA 02132, USA</aff><aff id="aff0002"><label>b</label>Neurotargeting Systems, Inc., Chestnut Hill, MA 02467, USA</aff><aff id="aff0003"><label>c</label>Department of Neurology, MassGeneral Institute of Neurodegenerative Diseases, Massachusetts General Hospital and Harvard Medical School, Charlestown, MA 02129, USA</aff></contrib-group><author-notes><corresp id="cor0001"><label>&#x0204e;</label>Corresponding author. <email>dmitry_gerashchenko@hms.harvard.edu</email></corresp></author-notes><pub-date pub-type="pmc-release"><day>08</day><month>8</month><year>2022</year></pub-date><!-- PMC Release delay is 0 months and 0 days and was based on <pub-date
						pub-type="epub">.--><pub-date pub-type="collection"><year>2022</year></pub-date><pub-date pub-type="epub"><day>08</day><month>8</month><year>2022</year></pub-date><volume>9</volume><elocation-id>101811</elocation-id><history><date date-type="received"><day>25</day><month>3</month><year>2022</year></date><date date-type="accepted"><day>13</day><month>7</month><year>2022</year></date></history><permissions><copyright-statement>&#x000a9; 2022 The Author(s)</copyright-statement><copyright-year>2022</copyright-year><license><ali:license_ref xmlns:ali="http://www.niso.org/schemas/ali/1.0/" specific-use="textmining" content-type="ccbyncndlicense">https://creativecommons.org/licenses/by-nc-nd/4.0/</ali:license_ref><license-p>This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/).</license-p></license></permissions><abstract id="abs0001"><p>Studying the biology of sleep requires accurate and efficient assessment of the sleep stages. However, analysis of sleep-wake cycles in mice and other laboratory animals remains a time-consuming and laborious process. In this study, we developed a Python script and a process for the streamlined analysis of sleep data that includes real-time processing of electroencephalogram (EEG) and electromyogram (EMG) signals that is compatible with commercial sleep-recording software that supports user datagram protocol (UDP) communication. The process consists of EEG/EMG data acquisition, automated threshold calculation for real-time determination of sleep stages, sleep staging and EEG power spectrum analysis. It also allows data storage in the format that facilitates further analysis of the sleep pattern in mice. The described method is aimed at increasing efficiency of sleep stage scoring and analysis in mice thus facilitating sleep research.</p><p>&#x02022; A process of EEG/EMG recording and streamline analysis of sleep-wake cycle in real time in mice.</p><p>&#x02022; The compatibility with commercial sleep-recording software that can generate a UDP stream.</p><p>&#x02022; The capability of further analysis of recorded data by an open-source software.</p></abstract><abstract abstract-type="graphical" id="abs0002"><title>Graphical Abstract</title><p><fig id="fig0006" position="anchor"><alt-text id="alttx001">Image, graphical abstract</alt-text><graphic xlink:href="ga1"/></fig></p></abstract><kwd-group id="keys0001"><title>Keywords</title><kwd>Sleep scoring</kwd><kwd>Vigilance states</kwd><kwd>EEG</kwd><kwd>EMG</kwd><kwd>Real-time analysis</kwd></kwd-group></article-meta></front><body><sec id="sec0001"><title>Specifications table</title><p id="para9001">
<table-wrap position="float" id="utbl0001"><table frame="hsides" rules="groups"><tbody><tr><td valign="top">Subject Area:</td><td valign="top"/></tr><tr><td valign="top">More specific subject area:</td><td valign="top"><italic>Sleep research</italic></td></tr><tr><td valign="top">Method name:</td><td valign="top"><italic>Real-time sleep recording and analysis</italic></td></tr><tr><td valign="top">Name and reference of original method:</td><td valign="top"><italic>N/A</italic></td></tr><tr><td valign="top">Resource availability:</td><td valign="top"><italic>N/A</italic></td></tr></tbody></table></table-wrap>
</p><p id="para0001">*Method details</p></sec><sec id="sec0002"><title>Introduction</title><p id="para0002">Accurate classification of behavioral states in mice is important to determine sleep structure in preclinical research. During recent years, many diverse algorithmic approaches have been developed to automate the sleep stage scoring process. For example, the deep learning algorithm for assessing sleep stages by the multimodal with fine-tuning approach achieved excellent performance in mice with an accuracy rate of 95.07% (% of epochs that were scored identically by automated and manual approaches) <xref rid="bib0001" ref-type="bibr">[1]</xref>. Alternatively, MC-SleepNet combines two types of deep neural networks that can automatically score sleep stages with an accuracy of 96.6% <xref rid="bib0002" ref-type="bibr">[2]</xref>, whereas mixture z-scoring, a machine learning algorithm used in AccuSleep, demonstrated an accuracy of 96.8% <xref rid="bib0003" ref-type="bibr">[3]</xref>. A very high accuracy of determining sleep stages was also achieved with automated sleep stage scoring using a k-nearest neighbors classifier <xref rid="bib0004" ref-type="bibr">[4]</xref>, a supervised deep convolutional neural network called WaveSleepNet <xref rid="bib0005" ref-type="bibr">[5]</xref>, a generative adversarial network-assisted image-based sleep staging program named GI-SleepNet <xref rid="bib0006" ref-type="bibr">[6]</xref>, and a neural network architecture that is able to distinguish between the three main stages Wake, REM and NREM as well as the infrequent stages pre-REM and artifact <xref rid="bib0007" ref-type="bibr">[7]</xref>. Although the accuracy of automated sleep staging is excellent, analysis of sleep-wake cycles in mice remains a time-consuming and laborious process. One of the challenges is that various data acquisition software save EEG and EMG traces in different formats that subsequently require conversion for the analysis. Another challenge arises from the need to analyze the EEG power spectrum, which requires extensive computer processing and considerable time commitment. To overcome these problems, we have developed a process for streamlining the sleep data analysis that includes processing of EEG and EMG signals. The process consists of EEG/EMG data acquisition via a UDP stream, automated calculation of thresholds for real-time determination of sleep stages, online sleep staging and EEG power spectrum analysis, as well as saving the data in the format that facilitates the further analysis of the sleep pattern in mice. Additionally, Transistor-Transistor Logic (TTL) pulses can be generated during particular stages of sleep to allow closed-loop stimulation, sleep deprivation, and other behavioral interventions in real time.</p></sec><sec id="sec0003"><title>Materials and methods</title><sec id="sec0004"><title>Animals</title><p id="para0003">Adult C57BL/6J mice (n=8, stock #000664), 3 to 6 months old, were obtained from the Jackson Laboratory. The mice were housed at 70&#x000b0;F - 74&#x000b0;F with a 12-h light/dark cycle (7:00 AM&#x02013;7:00 PM) and unlimited food and water. All procedures were conducted in accordance with Veterans Affairs (VA) &#x00026; National Institute of Health (NIH) guidelines and were approved by the VA Boston Healthcare System Institutional Animal Care and Use Committee. Adherence to transparent reporting was followed through the updated Animal Research: Reporting of In Vivo Experiments (ARRIVE 2.0) guidelines.</p></sec><sec id="sec0005"><title>Surgical techniques</title><p id="para0004">Mice were deeply anesthetized with isoflurane (1&#x02013;3%) and fixed to a stereotaxic frame. Skin over the skull was incised and retracted to expose the skull. An electroencephalogram (EEG) electrode was screwed into the skull above frontal cortex (AP&#x0202f;=&#x0202f;1.7; ML&#x0202f;=&#x0202f;&#x000b1;1), and a reference electrode was screwed into the skull above the cerebellum. Electromyogram (EMG) electrodes were placed in the nuchal muscle. The electrodes were then connected to a plug (PlasticsOne) and fixed to the skull using dental cement. Following the mounting of the electrodes on the skull with dental cement, the scalp incision was sutured closed. The mice were injected with meloxicam and allowed to recover.</p></sec><sec id="sec0006"><title>In vivo EEG/EMG recordings</title><p id="para0005">Following at least one week of postsurgical recovery and two days of adaptation to the recording chamber, mice were tethered to either the F20-EET wireless transmitter (DSI) or 3-channel wireless EEG/EMG system (Pinnacle Technology) on a swivel mounted system (Neurotargeting Systems) allowing them to move freely in their cage as previously described <xref rid="bib0008" ref-type="bibr">[8]</xref>. The data were transferred to either a receiver plate (DSI) or a USB dongle receiver (Pinnacle Technology). EEG and EMG signals were recorded via telemetry using Dataquest ART 4.1 software (DSI) at a frequency of 500 Hz or with Sirenia&#x000ae; acquisition software (Pinnacle Technology) at a frequency of 512 Hz. The data was either acquired via UDP communication and processed by the Python script or saved for subsequent analysis.</p></sec><sec id="sec0007"><title>Sleep data analysis</title><p id="para0006">The data files were imported to AccuSleep software for further manual scoring of sleep states in 5 second epochs during the 24-hour recording. The data transfer could occur after the recordings were completed or while the data acquisition was still going on. Vigilance states&#x02014;including NREM sleep, REM sleep, and waking&#x02014;were determined in 1 hour time blocks as previously described <xref rid="bib0008" ref-type="bibr">[8]</xref> as one of the following: (1) Wake; active behavior accompanied by desynchronized EEG (low in amplitude), and tonic/phasic motor activity evident in the EMG signal; (2) NREM sleep; more synchronized EEG, higher in amplitude, with particularly notable power in the delta (0.5-4.0 Hz) band, and low motor activity (EMG); and (3) REM sleep; small amplitude EEG, particularly notable power in the theta (4-9 Hz) band, and phasic motor activity (EMG). Compared to wake, EEG power during REM sleep was significantly reduced in delta frequencies (0.5-4.0 Hz) and increased in the range of theta activity (4-9 Hz). One hour of the EEG/EMG data was used to calculate thresholds for the Python script and generate a calibration file for the AccuSleep script. The thresholds and calibration files were then used to perform the automated sleep scoring. Accuracy, sensitivity, specificity and F1 score were calculated as previously described <xref rid="bib0009" ref-type="bibr">[9</xref>;<xref rid="bib0010" ref-type="bibr">10]</xref>.</p></sec><sec id="sec0008"><title>Statistical analysis</title><p id="para0007">Comparisons of the accuracy, sensitivity, specificity, and F1 score between different time intervals was done using one-way repeated-measures analysis of variance (ANOVA). Results are reported as mean &#x000b1; SEM.</p></sec></sec><sec id="sec0009"><title>Results</title><sec id="sec0010"><title>Description of the system for the real-time streamline analysis of sleep data in mice</title><sec id="sec0011"><title>Acquisition of EEG and EMG</title><p id="para0008">Commercial data acquisition software often require saving the EEG/EMG data in specialized formats. Most of the software allow data conversion into alternative formats, such as TXT or EDF, but the conversion requires significant amount of time, especially for recordings of long durations. To allow data storage in the desired format during the recording, we chose to acquire the data via the UDP stream. Some commercial programs (Sirenia by Pinnacle Technology, the Stellar system by TSE) allow generation of such data streams, and it is anticipated that other companies will include similar options in the near future. Our code allows for continuous data collection via the UDP and real-time sleep staging (<xref rid="fig0001" ref-type="fig">Fig. 1</xref> and Video 1). It also allows saving the data as .mat file for offline sleep staging (Video 2) and further analysis using MATLAB scripts.<fig id="fig0001"><label>Fig. 1</label><caption><p>Graphic interface of EEG and EMG recordings. EEG and EMG signals are sampled at 512 Hz by Sirenia Acquisition software (Pinnacle Technology) and transmitted using user datagram protocol (UDP). Five-second intervals of the EEG and EMG data are processed by the Python script and drawn in a separate window. Selected thresholds are shown in the upper left corner of the window. The EEG, Delta and Theta values recorded during the 5-second interval are displayed in the upper right corner and also visualized as bars on the right side of the window. The scored epoch (WAKE, NREM or REM) is shown at the top of the window.</p></caption><alt-text id="alt0002">Fig. 1</alt-text><graphic xlink:href="gr1"/></fig></p></sec><sec id="sec0012"><title>Sleep-scoring algorithm</title><p id="para0009">Sleep-scoring algorithms for determining sleep&#x02013;wake state using a computer-based analysis of EEG and EMG data are typically based on user defined logic rules/thresholds <xref rid="bib0011" ref-type="bibr">[11]</xref>, <xref rid="bib0012" ref-type="bibr">[12]</xref>, <xref rid="bib0013" ref-type="bibr">[13]</xref>, <xref rid="bib0014" ref-type="bibr">[14]</xref>, <xref rid="bib0015" ref-type="bibr">[15]</xref> or a machine learning approach [<xref rid="bib0001" ref-type="bibr">[1]</xref>, <xref rid="bib0002" ref-type="bibr">[2]</xref>, <xref rid="bib0003" ref-type="bibr">[3]</xref>, <xref rid="bib0004" ref-type="bibr">[4]</xref>, <xref rid="bib0005" ref-type="bibr">[5]</xref>;<xref rid="bib0007" ref-type="bibr">7</xref>;<xref rid="bib0009" ref-type="bibr">9</xref>;<xref rid="bib0016" ref-type="bibr">16]</xref>. The machine learning approaches generally result in a better accuracy of classifying the sleep stages, but the threshold-based approaches offer a greater ease of use and simplify making adjustments for each individual mouse. We decided to classify the sleep stages in real time based on 3 thresholds, making the program convenient to use. Because the data is saved in a .mat file, it can be analyzed directly by AccuSleep, a MATLAB script that allows determining sleep&#x02013;wake states with high accuracy <xref rid="bib0003" ref-type="bibr">[3]</xref>.</p><p id="para0010">A sleep-scoring algorithm that allows the real-time scoring of sleep&#x02013;wake state in mice is based on the classification procedure previously used in other research laboratories. <xref rid="bib0012" ref-type="bibr">[12]</xref>, <xref rid="bib0013" ref-type="bibr">[13]</xref>, <xref rid="bib0014" ref-type="bibr">[14]</xref>. As a first step, we assigned the time interval (epoch) for determining behavioral states. We selected the epoch duration of 5 seconds, but this could be adjusted according to the need of the research study. To process the EMG signal, we then (1) removed the mean value from the signal, (2) band pass-filtered (40&#x02013;90 Hz) the signal, (3) applied 4th order Butterworth filters, and (4) calculated the root&#x02010;mean&#x02010;square (RMS). The power spectral density (PSD) of the EEG was calculated using the Welch method in the following frequency ranges: (&#x003b4;: 0.5&#x02013;5 Hz; &#x003b8;: 6&#x02013;9 Hz; &#x003b1;: 10&#x02013;15 Hz; &#x003b7;: 16&#x02013;22.75 Hz and &#x003b2;: 23&#x02013;31.75 Hz). The delta band and theta band were specified according to the following formulas: (<italic>&#x003b4;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b1;)</italic>/(<italic>&#x003b7;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b2;)</italic> and (<italic>&#x003b8;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b8;)</italic>/(<italic>&#x003b4;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b1;)</italic>
<xref rid="bib0012" ref-type="bibr">[12]</xref>, <xref rid="bib0013" ref-type="bibr">[13]</xref>, <xref rid="bib0014" ref-type="bibr">[14]</xref>. Thus, we obtained three values (EMG RMS, EEG delta band and EEG theta band) that were subsequently used to discriminate between wakefulness, NREM sleep and REM sleep. The determination of the wake or sleep stage was done according to the following logic procedure:</p><p id="para0011">STEP 1: EMG RMS value is greater than EMG threshold.&#x0202f;&#x02192;&#x0202f;WAKEFULNESS</p><p id="para0012">STEP 2: EEG delta band <italic>(&#x003b4;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b1;)</italic>/(<italic>&#x003b7;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b2;)</italic> is lower than delta threshold and three preceding epochs were scored as WAKEFULNESS.&#x0202f;&#x02192;&#x0202f;WAKEFULNESS</p><p id="para0013">STEP 3: EEG delta band <italic>(&#x003b4;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b1;)</italic>/(<italic>&#x003b7;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b2;)</italic> is greater than delta threshold.&#x0202f;&#x02192;&#x0202f;NREM sleep</p><p id="para0014">STEP 4: EEG delta band <italic>(&#x003b4;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b1;)</italic>/(<italic>&#x003b7;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b2;)</italic> is greater than 80% of delta threshold and one preceding epoch was scored as NREM sleep.&#x0202f;&#x02192;&#x0202f;NREM sleep</p><p id="para0015">STEP 5: EEG delta band <italic>(&#x003b4;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b1;)</italic>/(<italic>&#x003b7;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b2;)</italic> is greater than 60% of delta threshold and two preceding epochs were scored as NREM sleep.&#x0202f;&#x02192;&#x0202f;NREM sleep</p><p id="para0016">STEP 5: EEG delta band <italic>(&#x003b4;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b1;)</italic>/(<italic>&#x003b7;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b2;)</italic> is greater than 40% of delta threshold and three preceding epochs were scored as NREM sleep.&#x0202f;&#x02192;&#x0202f;NREM sleep</p><p id="para0017">STEP 6: EEG theta band <italic>(&#x003b8;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b8;)</italic>/(<italic>&#x003b4;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b1;)</italic> is greater than theta threshold and any of two preceding epochs were not scored as WAKEFULNESS.&#x0202f;&#x02192;&#x0202f;REM sleep</p><p id="para0018">STEP 7: EEG theta band <italic>(&#x003b8;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b8;)</italic>/(<italic>&#x003b4;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b1;)</italic> is greater than 80% of theta threshold and the preceding epoch was scored as REM sleep.&#x0202f;&#x02192;&#x0202f;REM sleep</p><p id="para0019">STEP 8: EEG theta band <italic>(&#x003b8;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b8;)</italic>/(<italic>&#x003b4;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b1;)</italic> is greater than 60% of theta threshold and two preceding epochs were scored as REM sleep.&#x0202f;&#x02192;&#x0202f;REM sleep</p><p id="para0020">STEP 9: EEG theta band <italic>(&#x003b8;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b8;)</italic>/(<italic>&#x003b4;</italic>&#x0202f;&#x000d7;&#x0202f;<italic>&#x003b1;)</italic> is greater than 40% of theta threshold and three preceding epochs were scored as REM sleep.&#x0202f;&#x02192;&#x0202f;REM sleep</p><p id="para0021">STEP 10: None of the above conditions were true.&#x0202f;&#x02192;&#x0202f;WAKEFULNESS</p></sec><sec id="sec0013"><title>Threshold selection</title><p id="para0022">When thresholds are adjusted manually, it is difficult to reach a high accuracy of determining sleep&#x02013;wake states unless a large number of threshold combinations is tested. To solve this problem, we wrote a Python script that allows us to test 10,000 or even 100,000 combinations automatically in under a minute. According to our procedure, we select an hour of EEG and EMG recordings saved as .mat files and score sleep in 5 second epochs manually using the AccuSleep script. Then, the files containing the EEG and EMG data as well as the scored file containing assigned sleep epochs are processed by the Python script (<xref rid="fig0002" ref-type="fig">Fig. 2</xref>). The outcome of this procedure is 3 thresholds (EMG RMS, EEG delta band and EEG theta) selected based on the highest correspondence between epochs that were assigned identically by the Python script and manual scoring.<fig id="fig0002"><label>Fig. 2</label><caption><p>Automated selection of thresholds. An hour of recorded EEG and EMG data (EEG_0.mat and EEG_0.mat) and a file containing epochs scored in AccuSleep (labels_0.mat) are processed by the Python script to select the thresholds allowing the highest correspondence between the manual and automated scoring. The accuracy value and corresponding EMG, Delta and Theta thresholds are displayed on the screen.</p></caption><alt-text id="alt0003">Fig. 2</alt-text><graphic xlink:href="gr2"/></fig></p></sec><sec id="sec0014"><title>Determination of sleep-wake states in real time</title><p id="para0023">As soon as the thresholds are determined as described in the prior paragraph, they are entered into the Python script, after which the sleep recordings are restarted (<xref rid="fig0001" ref-type="fig">Fig. 1</xref>). The algorithm contains a graphical user interface for visualization of the EEG/EMG traces. The acquired data can be also visualized by the program through which the data stream is acquired. In this study, we used the Sirenia Acquisition program for this purpose. The assigned epochs are saved in a file named &#x0201c;Stages.csv&#x0201d;, and the power spectrum calculated during each 5 second epoch at the 0.5 Hz resolution is saved in a file named &#x0201c;FFT.csv&#x0201d;.</p></sec><sec id="sec0015"><title>Closed-loop feedback capability</title><p id="para0024">The Python script can output classification results in real-time to an Arduino device, which allows implementing a closed-loop feedback system of choice. The delay of initiating the feedback is 5 seconds due to the epoch window size. Additionally, the Arduino device is connected to a wireless remote controller that allows wireless control of various devices during specific states of sleep-wake cycle (<xref rid="fig0003" ref-type="fig">Fig. 3</xref>).<fig id="fig0003"><label>Fig. 3</label><caption><p>Interaction with external devices via Transistor-Transistor Logic (TTL). TTL interface allows turning on and off a remote control during chosen behavioral states.</p></caption><alt-text id="alt0004">Fig. 3</alt-text><graphic xlink:href="gr3"/></fig></p></sec></sec><sec id="sec0016"><title>Evaluation of the classification performance of the threshold-based method</title><sec id="sec0017"><title>The role of circadian time in threshold calculation</title><p id="para0025">In our method, threshold values are calculated based on a 1-hour sample of EEG/EMG data. Because the thresholds are used to determine sleep stages of the subsequent recordings, it is important to know whether selecting the sample data at a different circadian time has an effect on the accuracy of the sleep scoring procedure. To test the effect of the circadian time, we selected 4 intervals during which we calculated thresholds (ZT3-4, ZT8-9, ZT15-16, and ZT20-21). Two of these 1-hour intervals were selected during the light-on period (3 hours after the light on or 3 hours before the light off), and another two 1-hour intervals were selected during the light off period (3 hours after the light off or 3 hours before the light on). REM sleep was not present in some 1-hour intervals recorded during the light off period. In such cases, we replaced these intervals with the subsequent hour. The thresholds were calculated for each of these hours as described in the paragraph 3.1.3 and then used to perform automated staging during the entire 24 hours of the recording. Then, the accuracy of sleep staging was calculated by comparing the results of the automated and manual scoring during the 24-hour period. Additionally, the entire 24-hour period was used to calculate the thresholds to determine the highest level of accuracy that could be achieved by this method.</p><p id="para0026">As shown in <xref rid="fig0004" ref-type="fig">Fig. 4</xref>, accuracy of sleep staging exceeded 90% for all four intervals. The highest accuracy was achieved when the data recorded during ZT3-4 were used to determine thresholds (91.2%). However, one-way ANOVA with repeated measures did not identify significant differences between these time intervals (F(4, 28)&#x0202f;=&#x0202f;2.649, P&#x0202f;=&#x0202f;0.054). The highest accuracy reached 92.3% when the entire 24-h period was used to calculate the thresholds, which is 1.1% better than using the only ZT3-4 interval to calculate the thresholds. An example of comparison between the manual scoring and automated scoring by AccuSleep and Python script is shown in <xref rid="fig0005" ref-type="fig">Fig. 5</xref>.<fig id="fig0004"><label>Fig. 4</label><caption><p>Effect of the choice of the time interval used to determine thresholds on the accuracy of sleep staging. The accuracy was about 90% or more for all tested intervals.</p></caption><alt-text id="alt0005">Fig. 4</alt-text><graphic xlink:href="gr4"/></fig><fig id="fig0005"><label>Fig. 5</label><caption><p>A representative example of automated sleep scoring by the threshold-based Python script and AccuSleep script. One hour of the EEG/EMG data recorded during the ZT3-4 time interval was used to automatically determine the thresholds for the Python script and produce a calibration file for the AccuSleep script. One hour of EEG/EMG data recorded five hours later (ZT8-9) in the same mouse was then automatically scored by both scripts. A high correspondence between the manual scoring and automated scoring by both scripts was observed. The figure was produced using the AccuSleep script in MATLAB.</p></caption><alt-text id="alt0006">Fig. 5</alt-text><graphic xlink:href="gr5"/></fig></p></sec><sec id="sec0018"><title>Sensitivity, specificity and F1 score</title><p id="para0027">In addition to assessing the overall accuracy of sleep staging, we used sensitivity, specificity and F1 score as additional metrics of classification performance for specific behavioral stages. In this analysis, we determined thresholds based on the ZT3-4 interval and then used them to assign sleep stages for the entire 24-hour recording. As shown in <xref rid="tbl0001" ref-type="table">Table 1</xref>, a high level of these measures (90% or more) was obtained for wakefulness and NREM sleep. The level of sensitivity and F1 score were around 70% for REM sleep.<table-wrap position="float" id="tbl0001"><label>Table 1</label><caption><p>Performance evaluation of wakefulness, NREM sleep, and REM sleep staging. The thresholds calculated during ZT3-4 in 8 mice were used to automatically stage sleep for 24 hours in the same mice. The 24-h data were scored manually and compared to the result of automated scoring. The highest sensitivity, specificity and F1 score were observed for wakefulness.</p></caption><alt-text id="alt0007">Table 1</alt-text><table frame="hsides" rules="groups"><thead><tr><th valign="top"/><th valign="top">Sensitivity</th><th valign="top">Specificity</th><th valign="top">F1 score</th></tr></thead><tbody><tr><td valign="top">Wake</td><td valign="top">93.5 &#x000b1; 1.1</td><td valign="top">92.4 &#x000b1; 2.2</td><td valign="top">93.6 &#x000b1; 1.0</td></tr><tr><td valign="top">NREM sleep</td><td valign="top">91.0 &#x000b1; 2.4</td><td valign="top">92.7 &#x000b1; 1.1</td><td valign="top">89.6 &#x000b1; 1.1</td></tr><tr><td valign="top">REM sleep</td><td valign="top">68.3 &#x000b1; 2.3</td><td valign="top">99.1 &#x000b1; 0.2</td><td valign="top">73.3 &#x000b1; 2.8</td></tr></tbody></table></table-wrap></p></sec></sec></sec><sec id="sec0019"><title>Discussion</title><p id="para0028">A large number of highly accurate behavioral state classifiers for automatic sleep staging have been developed in recent years. Most common automated sleep scoring approaches are based on either thresholds/logic rules <xref rid="bib0011" ref-type="bibr">[11]</xref>, <xref rid="bib0012" ref-type="bibr">[12]</xref>, <xref rid="bib0013" ref-type="bibr">[13]</xref>, <xref rid="bib0014" ref-type="bibr">[14]</xref>, <xref rid="bib0015" ref-type="bibr">[15]</xref> or machine learning algorithms [<xref rid="bib0001" ref-type="bibr">[1]</xref>, <xref rid="bib0002" ref-type="bibr">[2]</xref>, <xref rid="bib0003" ref-type="bibr">[3]</xref>, <xref rid="bib0004" ref-type="bibr">[4]</xref>, <xref rid="bib0005" ref-type="bibr">[5]</xref>;<xref rid="bib0007" ref-type="bibr">7</xref>;<xref rid="bib0009" ref-type="bibr">9</xref>;<xref rid="bib0016" ref-type="bibr">16]</xref>. These approaches typically use the power spectrum of the EEG signal in combination with EMG signal power to determine sleep stages, although they differ in how those characteristics are selected and combined to predict behavioral states. In this study, we also used EEG and EMG for sleep staging and achieved a high accuracy of behavioral stage detection based only on 3 thresholds and a few logic rules. The accuracy depended on the quality of EEG and EMG recordings, as it varied from 86% to 95%. The sleep staging worked particularly well for recognizing wakefulness and NREM sleep, so sensitivity, specificity, and F1 scores were over 90% for wakefulness and NREM sleep (<xref rid="tbl0001" ref-type="table">Table 1</xref>). Sensitivity and F1 score were lower for REM sleep compared to other behavioral states (about 70%).</p><p id="para0029">Although reaching high accuracy of sleep staging is important, it was not the main goal of our study. Instead, we focused on the major obstacles that sleep researchers face during data collection and analysis in mice. These obstacles include difficulties in efficient collection and processing of large EEG and EMG datasets that are often sampled at a high rate for weeks or even months. We rationalized that the efficiency of sleep analysis would be significantly improved if the collected data are processed in real time while they are collected on the computer. Thus, we wrote a Python script that allows calculating the PSD and sleep stage for each epoch at the time of data collection, which are then saved on the computer in separate files. Other difficulty in processing the data derives from the variability of formats in which the EEG and EMG data are saved. If the format of saved data cannot be read by a sleep-analysis software, a conversion to another format is needed. To avoid such a problem, we collected data via the UDP communications protocol and saved it in .mat files that can be directly read by the AccuSleep script. AccuSleep was chosen because it is an open source MATLAB script that demonstrated one of the highest accuracies of sleep staging in mice <xref rid="bib0003" ref-type="bibr">[3]</xref>. Additionally, it has a user-friendly interface and is simple to use (<xref rid="fig0005" ref-type="fig">Fig. 5</xref>).</p><p id="para0030">Another advantage of processing the data in real time is that it gives a possibility to perform various sleep-depended behavioral interventions. Considering that our script demonstrated a high accuracy in detecting wakefulness, we anticipate that it will be particularly useful for automated sleep deprivation protocols. It could be also employed in closed-loop stimulation and other protocols that require performing various research manipulations (optogenetic, auditory or visual stimulation, etc.) specifically during wakefulness or sleep.</p><p id="para0031">The presented method has limitations. One potential limitation derives from the use of UDP communication. Despite its high efficiency in transmitting data, such communication could potentially generate errors because UDP does not use an error control. Although we did not notice errors during this study, they may arise in certain situations. Other likely limitation may be reduced accuracy of sleep staging in case the EEG and EEG signals are noisy or are missing some data. In this study, we did not test the ability of our script to discriminate between sleep stages when the EEG and/or EEG contained many artifacts. If artifacts significantly impact the accuracy of sleep staging, the algorithm can be modified to remove most of them as it has been done in previous studies <xref rid="bib0014" ref-type="bibr">[14]</xref>, or an error-correcting connection can be used.</p><p id="para0032">In conclusion, we developed a Python script and a process for a streamline analysis of sleep-wake cycle in mice that is compatible with commercial sleep-recording software that can generate a UDP stream of EEG and EMG signals. The real-time data processing and the capability of further analysis of recorded data by an open-source software is likely to make this script a useful tool for the research community.</p></sec><sec sec-type="data-availability" id="sec0020"><title>Data availability</title><p id="para0033">All data generated or analyzed during this study is included in the published article. Datasets not included are available from the corresponding author upon reasonable request.</p></sec><sec sec-type="COI-statement"><title>Declaration of competing interest</title><p id="para0037">DG has family members employed by Neurotargeting Systems, and AG has affiliation with Neurotargeting Systems.</p></sec></body><back><ref-list id="cebibl1"><title>References</title><ref id="bib0001"><label>1</label><element-citation publication-type="journal" id="sbref0001"><person-group person-group-type="author"><name><surname>Yagi</surname><given-names>T.</given-names></name><name><surname>Akada</surname><given-names>K.</given-names></name><name><surname>Beuckmann</surname><given-names>C.T.</given-names></name><name><surname>Miura</surname><given-names>Y.</given-names></name><name><surname>Aoshima</surname><given-names>K.</given-names></name><name><surname>Koyama</surname><given-names>N.</given-names></name></person-group><article-title>A deep learning algorithm for sleep stage scoring in mice based on a multimodal network with fine-tuning technique</article-title><source>Neurosci. Res.</source><volume>173</volume><year>2021</year><fpage>99</fpage><lpage>105</lpage><pub-id pub-id-type="pmid">34280429</pub-id></element-citation></ref><ref id="bib0002"><label>2</label><element-citation publication-type="journal" id="sbref0002"><person-group person-group-type="author"><name><surname>Yamabe</surname><given-names>M.</given-names></name><name><surname>Horie</surname><given-names>K.</given-names></name><name><surname>Shiokawa</surname><given-names>H.</given-names></name><name><surname>Funato</surname><given-names>H.</given-names></name><name><surname>Yanagisawa</surname><given-names>M.</given-names></name><name><surname>Kitagawa</surname><given-names>H.</given-names></name></person-group><article-title>MC-SleepNet: large-scale sleep stage scoring in mice by deep neural networks</article-title><source>Sci. Rep</source><volume>9</volume><year>2019</year><fpage>15793</fpage><pub-id pub-id-type="pmid">31672998</pub-id></element-citation></ref><ref id="bib0003"><label>3</label><element-citation publication-type="journal" id="sbref0003"><person-group person-group-type="author"><name><surname>Barger</surname><given-names>Z.</given-names></name><name><surname>Frye</surname><given-names>C.G.</given-names></name><name><surname>Liu</surname><given-names>D.</given-names></name><name><surname>Dan</surname><given-names>Y.</given-names></name><name><surname>Bouchard</surname><given-names>K.E.</given-names></name></person-group><article-title>Robust, automated sleep scoring by a compact neural network with distributional shift correction</article-title><source>PLoS.ONE</source><volume>14</volume><year>2019</year><object-id pub-id-type="publisher-id">e0224642</object-id></element-citation></ref><ref id="bib0004"><label>4</label><element-citation publication-type="journal" id="sbref0004"><person-group person-group-type="author"><name><surname>Morairty</surname><given-names>S.</given-names></name><name><surname>Kiss</surname><given-names>T.</given-names></name><name><surname>Kilduff</surname><given-names>T.S.</given-names></name><name><surname>Schwartz</surname><given-names>M.</given-names></name><name><surname>Volfson</surname><given-names>D.</given-names></name><name><surname>Buhl</surname><given-names>D.L.</given-names></name></person-group><article-title>Automated sleep stage scoring using k-nearest neighbors classifier</article-title><source>J. Open Source Softw.</source><volume>5</volume><year>2020</year><fpage>2377</fpage></element-citation></ref><ref id="bib0005"><label>5</label><element-citation publication-type="journal" id="sbref0005"><person-group person-group-type="author"><name><surname>Rapoport</surname><given-names>D.M.</given-names></name><name><surname>Kam</surname><given-names>K.</given-names></name><name><surname>Ayappa</surname><given-names>I.</given-names></name><name><surname>Parekh</surname><given-names>A.</given-names></name><name><surname>Varga</surname><given-names>A.W.</given-names></name></person-group><article-title>WaveSleepNet: an interpretable deep convolutional neural network for the continuous classification of mouse sleep and wake</article-title><source>J. Neurosci. Methods</source><volume>360</volume><year>2021</year><object-id pub-id-type="publisher-id">109224</object-id></element-citation></ref><ref id="bib0006"><label>6</label><element-citation publication-type="journal" id="sbref0006"><person-group person-group-type="author"><name><surname>Gao</surname><given-names>T.</given-names></name><name><surname>Li</surname><given-names>J.</given-names></name><name><surname>Watanabe</surname><given-names>Y.</given-names></name><name><surname>Hung</surname><given-names>C.</given-names></name><name><surname>Yamanaka</surname><given-names>A.</given-names></name><name><surname>Horie</surname><given-names>K.</given-names></name><name><surname>Yanagisawa</surname><given-names>M.</given-names></name><name><surname>Ohsawa</surname><given-names>M.</given-names></name><name><surname>Kume</surname><given-names>K.</given-names></name></person-group><article-title>GI-SleepNet: a highly versatile image-based sleep classification using a deep learning algorithm</article-title><source>Clocks. Sleep</source><volume>3</volume><year>2021</year><fpage>581</fpage><lpage>597</lpage><pub-id pub-id-type="pmid">34842647</pub-id></element-citation></ref><ref id="bib0007"><label>7</label><element-citation publication-type="journal" id="sbref0007"><person-group person-group-type="author"><name><surname>Schwabedal</surname><given-names>J.T.C.</given-names></name><name><surname>Grieger</surname><given-names>N.</given-names></name><name><surname>Ritze</surname><given-names>Y.</given-names></name><name><surname>Wendel</surname><given-names>S.</given-names></name><name><surname>Bialonski</surname><given-names>S.</given-names></name></person-group><article-title>Automated scoring of pre-REM sleep in mice with deep learning</article-title><source>Sci. Rep</source><volume>11</volume><year>2021</year><fpage>12245</fpage><pub-id pub-id-type="pmid">34112829</pub-id></element-citation></ref><ref id="bib0008"><label>8</label><element-citation publication-type="journal" id="sbref0008"><person-group person-group-type="author"><name><surname>Gerashchenko</surname><given-names>L.</given-names></name><name><surname>Zielinski</surname><given-names>M.R.</given-names></name><name><surname>Gerashchenko</surname><given-names>D.</given-names></name><name><surname>Karpova</surname><given-names>S.A.</given-names></name></person-group><article-title>A novel telemetric system to measure polysomnographic biopotentials in freely moving animals</article-title><source>J. Neurosci. Methods</source><volume>216</volume><year>2013</year><fpage>79</fpage><lpage>86</lpage><pub-id pub-id-type="pmid">23563323</pub-id></element-citation></ref><ref id="bib0009"><label>9</label><element-citation publication-type="journal" id="sbref0009"><person-group person-group-type="author"><name><surname>Kumar</surname><given-names>D.</given-names></name><name><surname>Tezuka</surname><given-names>T.</given-names></name><name><surname>Koyanagi</surname><given-names>I.</given-names></name><name><surname>Singh</surname><given-names>S.</given-names></name><name><surname>Sakaguchi</surname><given-names>M.</given-names></name><name><surname>Naoi</surname><given-names>T.</given-names></name></person-group><article-title>Real-time, automatic, open-source sleep stage classification system using single EEG for mice</article-title><source>Sci. Rep</source><volume>11</volume><year>2021</year><fpage>11151</fpage><pub-id pub-id-type="pmid">34045518</pub-id></element-citation></ref><ref id="bib0010"><label>10</label><element-citation publication-type="journal" id="sbref0010"><person-group person-group-type="author"><name><surname>Sei</surname><given-names>H.</given-names></name><name><surname>Sunagawa</surname><given-names>G.A.</given-names></name><name><surname>Urade</surname><given-names>Y.</given-names></name><name><surname>Shimba</surname><given-names>S.</given-names></name><name><surname>Ueda</surname><given-names>H.R.</given-names></name></person-group><article-title>FASTER: an unsupervised fully automated sleep staging method for mice</article-title><source>Genes Cells</source><volume>18</volume><year>2013</year><fpage>502</fpage><lpage>518</lpage><pub-id pub-id-type="pmid">23621645</pub-id></element-citation></ref><ref id="bib0011"><label>11</label><element-citation publication-type="journal" id="sbref0011"><person-group person-group-type="author"><name><surname>Izawa</surname><given-names>S.</given-names></name><name><surname>Chowdhury</surname><given-names>S.</given-names></name><name><surname>Miyazaki</surname><given-names>T.</given-names></name><name><surname>Mukai</surname><given-names>Y.</given-names></name><name><surname>Ono</surname><given-names>D.</given-names></name><name><surname>Inoue</surname><given-names>R.</given-names></name><name><surname>Ohmura</surname><given-names>Y.</given-names></name><name><surname>Mizoguchi</surname><given-names>H.</given-names></name><name><surname>Kimura</surname><given-names>K.</given-names></name><name><surname>Yoshioka</surname><given-names>M.</given-names></name><name><surname>Terao</surname><given-names>A.</given-names></name><name><surname>Kilduff</surname><given-names>T.S.</given-names></name><name><surname>Yamanaka</surname><given-names>A.</given-names></name></person-group><article-title>REM sleep-active MCH neurons are involved in forgetting hippocampus-dependent memories</article-title><source>Science</source><volume>365</volume><year>2019</year><fpage>1308</fpage><lpage>1313</lpage><pub-id pub-id-type="pmid">31604241</pub-id></element-citation></ref><ref id="bib0012"><label>12</label><element-citation publication-type="journal" id="sbref0012"><person-group person-group-type="author"><name><surname>Romanowski</surname><given-names>C.P.</given-names></name><name><surname>Fenzl</surname><given-names>T.</given-names></name><name><surname>Honsberg</surname><given-names>K.</given-names></name><name><surname>Flachskamm</surname><given-names>C.</given-names></name><name><surname>Hoehne</surname><given-names>A.</given-names></name><name><surname>Boll</surname><given-names>E.</given-names></name><name><surname>Kimura</surname><given-names>M.</given-names></name></person-group><article-title>Fully automated sleep deprivation in mice as a tool in sleep research</article-title><source>J. Neurosci. Methods</source><volume>166</volume><year>2007</year><fpage>229</fpage><lpage>235</lpage><pub-id pub-id-type="pmid">17825425</pub-id></element-citation></ref><ref id="bib0013"><label>13</label><element-citation publication-type="journal" id="sbref0013"><person-group person-group-type="author"><name><surname>Lee</surname><given-names>J.</given-names></name><name><surname>Louis</surname><given-names>R.P.</given-names></name><name><surname>Stephenson</surname><given-names>R.</given-names></name></person-group><article-title>Design and validation of a computer-based sleep-scoring algorithm</article-title><source>J. Neurosci. Methods</source><volume>133</volume><year>2004</year><fpage>71</fpage><lpage>80</lpage><pub-id pub-id-type="pmid">14757347</pub-id></element-citation></ref><ref id="bib0014"><label>14</label><element-citation publication-type="journal" id="sbref0014"><person-group person-group-type="author"><name><surname>Polta</surname><given-names>S.</given-names></name><name><surname>Kreuzer</surname><given-names>M.</given-names></name><name><surname>Schuler</surname><given-names>C.</given-names></name><name><surname>Gapp</surname><given-names>J.</given-names></name><name><surname>Fenzl</surname><given-names>T.</given-names></name><name><surname>Kochs</surname><given-names>E.F.</given-names></name></person-group><article-title>Sleep scoring made easy-Semi-automated sleep analysis software and manual rescoring tools for basic sleep research in mice</article-title><source>MethodsX</source><volume>2</volume><year>2015</year><fpage>232</fpage><lpage>240</lpage><pub-id pub-id-type="pmid">26150993</pub-id></element-citation></ref><ref id="bib0015"><label>15</label><element-citation publication-type="journal" id="sbref0015"><person-group person-group-type="author"><name><surname>Walsh</surname><given-names>C.M.</given-names></name><name><surname>Gross</surname><given-names>B.A.</given-names></name><name><surname>Booth</surname><given-names>V.</given-names></name><name><surname>Turakhia</surname><given-names>A.A.</given-names></name><name><surname>Poe</surname><given-names>G.R.</given-names></name><name><surname>Mashour</surname><given-names>G.A.</given-names></name></person-group><article-title>Open-source logic-based automated sleep scoring software using electrophysiological recordings in rats</article-title><source>J. Neurosci. Methods</source><volume>184</volume><year>2009</year><fpage>10</fpage><lpage>18</lpage><pub-id pub-id-type="pmid">19615408</pub-id></element-citation></ref><ref id="bib0016"><label>16</label><element-citation publication-type="journal" id="sbref0016"><person-group person-group-type="author"><name><surname>Dash</surname><given-names>M.B.</given-names></name><name><surname>Ellen</surname><given-names>J.G.</given-names></name></person-group><article-title>An artificial neural network for automated behavioral state classification in rats</article-title><source>Peer J.</source><volume>9</volume><year>2021</year><fpage>e12127</fpage><pub-id pub-id-type="pmid">34589305</pub-id></element-citation></ref></ref-list><sec id="sec0024" sec-type="supplementary-material"><label>Appendix</label><title>Supplementary materials</title><p id="para0035a">
<supplementary-material content-type="local-data" id="ecom0001"><caption><p><bold>Video 1</bold>. The process of continuous data collection via the UDP and real-time sleep staging. After the UDP stream is initiated in the Sirenia Acquisition program, the Python script is started. EEG and EMG signals are drawn every 5 s in a separate window. Scored behavioral stages, power spectrum information, and acquired EEG and EMG signals are saved in the same folder.</p></caption><media xlink:href="mmc1.mp4"><alt-text>Image, video 1</alt-text></media></supplementary-material>
<supplementary-material content-type="local-data" id="ecom0002"><caption><p><bold>Video 2</bold>. Offline analysis of recorded data by the Python script. The result of offline analysis is the file containing scored behavioral stages and the file containing power spectrum information. In this video, EEG and EMG signals are drawn every second. Visualization of the sleep staging can be turned off to speed up the data processing.</p></caption><media xlink:href="mmc2.mp4"><alt-text>Image, video 2</alt-text></media></supplementary-material>
</p></sec><ack id="ack0001"><sec id="sec0021"><title>Acknowledgements</title><p id="para0038">This work was supported by NIH NIA-AG061774. We are thankful to Neurotargeting Systems for providing us an apparatus for connecting with freely moving mice and writing the Python script (AG) for this study.</p></sec></ack><fn-group><fn id="sec0023" fn-type="supplementary-material"><p id="para0001a">Supplementary material associated with this article can be found, in the online version, at doi:<ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.mex.2022.101811" id="interref0001">10.1016/j.mex.2022.101811</ext-link>.</p></fn></fn-group></back></article>
